# äºŒæ‰‹å¸‚åœºåº”ç”¨é¡¹ç›®æ£€æŸ¥æŠ¥å‘Š

## ğŸ” æ£€æŸ¥ç»“æœæ€»è§ˆ

### âœ… å¯ä»¥è¿è¡Œçš„éƒ¨åˆ†
- âœ… å‰ç«¯ä¾èµ–å·²å®‰è£…å®Œæˆ
- âœ… å‰ç«¯é¡¹ç›®ç»“æ„å®Œæ•´
- âœ… åç«¯ä»£ç ç»“æ„å®Œæ•´
- âœ… åŸºç¡€é…ç½®æ–‡ä»¶å­˜åœ¨

### âš ï¸ éœ€è¦ä¿®å¤çš„é—®é¢˜
- âš ï¸ æ•°æ®åº“é…ç½®ä¸åŒ¹é…ï¼ˆPostgreSQL vs H2ï¼‰
- âš ï¸ å‰ç«¯APIè·¯å¾„ä¸åç«¯ä¸åŒ¹é…
- âš ï¸ èŠå¤©åŠŸèƒ½å‰ç«¯ç¼ºå¤±
- âš ï¸ éƒ¨åˆ†APIæ¥å£æœªåœ¨å‰ç«¯ä½¿ç”¨

---

## ğŸ“‹ è¯¦ç»†é—®é¢˜åˆ†æ

### 1. ğŸ—„ï¸ æ•°æ®åº“é…ç½®é—®é¢˜

#### é—®é¢˜æè¿°
- **åç«¯é…ç½®**: ä½¿ç”¨PostgreSQLæ•°æ®åº“
- **å¼€å‘ç¯å¢ƒ**: åº”è¯¥ä½¿ç”¨H2å†…å­˜æ•°æ®åº“
- **å½±å“**: é¡¹ç›®æ— æ³•æ­£å¸¸å¯åŠ¨

#### è§£å†³æ–¹æ¡ˆ
éœ€è¦ä¿®æ”¹ `src/main/resources/application.yml`:

```yaml
spring:
  datasource:
    url: jdbc:h2:mem:testdb
    username: sa
    password: 
    driver-class-name: org.h2.Driver
  h2:
    console:
      enabled: true
      path: /h2-console
```

åŒæ—¶éœ€è¦ä¿®æ”¹ `build.gradle`ï¼Œæ·»åŠ H2ä¾èµ–ï¼š

```gradle
dependencies {
    // ç°æœ‰ä¾èµ–...
    runtimeOnly 'com.h2database:h2'
    // æ³¨é‡Šæ‰PostgreSQL
    // runtimeOnly 'org.postgresql:postgresql:42.6.0'
}
```

### 2. ğŸ”— APIè·¯å¾„ä¸åŒ¹é…é—®é¢˜

#### é—®é¢˜æè¿°
| åç«¯APIè·¯å¾„ | å‰ç«¯è°ƒç”¨è·¯å¾„ | çŠ¶æ€ |
|------------|-------------|------|
| `/api/auth/signup` | `/auth/register` | âŒ ä¸åŒ¹é… |
| `/api/auth/login` | `/auth/login` | âŒ ä¸åŒ¹é… |
| `/items` | `/products` | âŒ ä¸åŒ¹é… |
| `/chatRooms` | æ— å‰ç«¯è°ƒç”¨ | âŒ ç¼ºå¤± |

#### è§£å†³æ–¹æ¡ˆ
éœ€è¦ä¿®æ”¹å‰ç«¯APIæœåŠ¡æ–‡ä»¶ï¼š

**ä¿®æ”¹ `frontend/src/services/authApi.ts`:**
```typescript
export const loginApi = (data: { email: string; password: string }) => {
  return api.post("/api/auth/login", data).then((res) => res.data);
};

export const registerApi = (data: { email: string; password: string }) => {
  return api.post("/api/auth/signup", data).then((res) => res.data);
};
```

**ä¿®æ”¹ `frontend/src/services/productApi.ts`:**
```typescript
// å°†æ‰€æœ‰ /products æ”¹ä¸º /items
export const createProductApi = async (data: CreateProductRequest): Promise<Product> => {
  // ...
  const response = await api.post("/items", formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
  // ...
};

export const getProductApi = (id: string): Promise<Product> => {
  return api.get(`/items/${id}`).then((res) => res.data);
};

export const getProductsApi = (params?: {...}): Promise<{...}> => {
  return api.get("/items", { params }).then((res) => res.data);
};
```

### 3. ğŸ’¬ èŠå¤©åŠŸèƒ½ç¼ºå¤±

#### é—®é¢˜æè¿°
- åç«¯æœ‰å®Œæ•´çš„èŠå¤©åŠŸèƒ½API
- å‰ç«¯ç¼ºå°‘èŠå¤©ç›¸å…³çš„ç»„ä»¶å’ŒæœåŠ¡
- èŠå¤©åŠŸèƒ½æ— æ³•ä½¿ç”¨

#### è§£å†³æ–¹æ¡ˆ
éœ€è¦åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ï¼š

**åˆ›å»º `frontend/src/services/chatApi.ts`:**
```typescript
import api from '../utils/api';

export interface ChatRoom {
  id: number;
  name: string;
  buyer: string;
  seller: string;
  itemId: number;
  closed: boolean;
  createdAt: string;
}

export interface Message {
  id: number;
  chatRoomId: number;
  sender: string;
  content: string;
  messageType: string;
  createdAt: string;
}

export const createChatRoomApi = (data: {
  buyer: string;
  seller: string;
  itemId: number;
}) => {
  return api.post("/chatRooms", data).then((res) => res.data);
};

export const getChatRoomsByUserApi = (username: string) => {
  return api.get(`/chatRooms/user/${username}`).then((res) => res.data);
};

export const getChatRoomMessagesApi = (chatRoomId: number) => {
  return api.get(`/chatRooms/${chatRoomId}`).then((res) => res.data);
};

export const sendMessageApi = (chatRoomId: number, data: {
  sender: string;
  content: string;
  messageType: string;
}) => {
  return api.post(`/chatRooms/${chatRoomId}/messages`, data).then((res) => res.data);
};
```

### 4. ğŸ§¹ æœªä½¿ç”¨çš„åŠŸèƒ½

#### åç«¯æœªä½¿ç”¨çš„API
- `PUT /items/{id}/mark-sold` - æ ‡è®°å•†å“ä¸ºå·²å”®
- `PUT /chatRooms/{id}/close` - å…³é—­èŠå¤©å®¤
- `GET /chatRooms/messages/bySender/{sender}` - è·å–ç”¨æˆ·å‘é€çš„æ¶ˆæ¯

#### å»ºè®®
- è¿™äº›åŠŸèƒ½å¯ä»¥ä¿ç•™ï¼Œä¸ºå°†æ¥æ‰©å±•åšå‡†å¤‡
- æˆ–è€…åœ¨å‰ç«¯æ·»åŠ ç›¸åº”çš„åŠŸèƒ½æŒ‰é’®

---

## ğŸš€ ä¿®å¤æ­¥éª¤

### æ­¥éª¤1: ä¿®å¤æ•°æ®åº“é…ç½®
1. ä¿®æ”¹ `application.yml` ä½¿ç”¨H2æ•°æ®åº“
2. ä¿®æ”¹ `build.gradle` æ·»åŠ H2ä¾èµ–
3. æ³¨é‡Šæ‰PostgreSQLä¾èµ–

### æ­¥éª¤2: ä¿®å¤APIè·¯å¾„
1. ä¿®æ”¹ `authApi.ts` ä¸­çš„APIè·¯å¾„
2. ä¿®æ”¹ `productApi.ts` ä¸­çš„APIè·¯å¾„
3. åˆ›å»º `chatApi.ts` æ–‡ä»¶

### æ­¥éª¤3: æµ‹è¯•è¿æ¥
1. å¯åŠ¨åç«¯æœåŠ¡
2. å¯åŠ¨å‰ç«¯æœåŠ¡
3. æµ‹è¯•å„ä¸ªåŠŸèƒ½æ¨¡å—

---

## âœ… ä¿®å¤åçš„é¢„æœŸç»“æœ

### å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„åŠŸèƒ½
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- âœ… å•†å“å‘å¸ƒ/æµè§ˆ
- âœ… èŠå¤©åŠŸèƒ½
- âœ… ä¸ªäººèµ„æ–™ç®¡ç†

### è®¿é—®åœ°å€
- å‰ç«¯: http://localhost:5173
- åç«¯: http://localhost:8080
- æ•°æ®åº“æ§åˆ¶å°: http://localhost:8080/h2-console

---

## ğŸ”§ å¿«é€Ÿä¿®å¤è„šæœ¬

æˆ‘å¯ä»¥ä¸ºæ‚¨åˆ›å»ºè‡ªåŠ¨ä¿®å¤è„šæœ¬ï¼Œä¸€é”®è§£å†³æ‰€æœ‰é…ç½®é—®é¢˜ã€‚æ‚¨å¸Œæœ›æˆ‘ç»§ç»­ä¿®å¤è¿™äº›é—®é¢˜å—ï¼Ÿ 